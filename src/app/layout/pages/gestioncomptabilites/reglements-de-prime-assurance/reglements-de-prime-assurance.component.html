<div class="page-container" >
     <!-- Header -->
    <div class="page-header">
        <div class="header-content">
          <div class="header-title">
            <div class="title-icon">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                <path d="M8.646 6.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 9 8.646 7.354a.5.5 0 0 1 0-.708zm-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 9l1.647-1.646a.5.5 0 0 0 0-.708z"/>
              </svg>
            </div>
            <div>
              <h1>Réglement de Prime</h1>
              <p>Réglement et impression des reçus de caisse</p>
            </div>
          </div>
        </div>
      </div>
     <!-- Section Recherche -->
  <div  class="card form-section animate-slide-in-up">
    <div class="card-body form-container">
      <h2 class="card-title">Rechercher un Contrat</h2>
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="form">
        <div class="form-row">
          <div class="form-group">
            <label for="numeroPiece">Numéro de Police *</label>
            <input type="text" id="numeroPiece" formControlName="numeroPiece" class="form-input" placeholder="Ex: RC-2024-003" />
            <div *ngIf="submitted && searchForm.get('numeroPiece')?.invalid" class="text-red">
              Ce champ est requis.
            </div>
          </div>
          <div class="form-group">
            <button type="submit" [disabled]="isLoading" class="btn btn-primary">
              <span *ngIf="!isLoading">Rechercher</span>
              <span *ngIf="isLoading">Recherche...</span>
            </button>
          </div>
        </div>
        <div *ngIf="searchError" class="text-red bg-red-light p-3 rounded mt-4">
          {{ searchError }}
        </div>
      </form>
    </div>
  </div><br><br>

  <!-- Détails du Contrat & Règlement -->
<div *ngIf="contrat" class="animate-slide-in-up">
    <div class="card detail-card">
      <div class="card-body">
        <h3 class="card-title">Reglements De Prime Assurance</h3><br><br>
         <!-- Side-by-side layout only if contrat exists -->
            <div *ngIf="contrat" class="side-by-side-layout animate-slide-in-up">
            <div class="card details-card">
                <div class="card-body">
                <h3 class="card-title">Détails du Contrat</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                    <label>Numéro de Pièce</label>
                    <div class="detail-value">{{ contrat.numeroPiece }}</div>
                    </div>
                    <div class="detail-item">
                    <label>Client</label>
                    <div class="detail-value">{{ contrat.client }}</div>
                    </div>
                    <div class="detail-item">
                    <label>Date d'Effet</label>
                    <div class="detail-value">{{ contrat.dateEffet | date:'dd/MM/yyyy' }}</div>
                    </div>
                    <div class="detail-item">
                    <label>Montant Prime</label>
                    <div class="detail-value amount">{{ contrat.montantPrime | number:'1.2-2' }} €</div>
                    </div>
                    <div class="detail-item">
                    <label>Statut</label>
                    <div class="detail-value">
                        <span class="status-badge" [ngClass]="contrat.statut === 'Payé' ? 'status-active' : 'status-inactive'">
                        {{ contrat.statut }}
                        </span>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            <div class="card reglement-card">
                <div class="card-body">
                <h3 class="card-title">Effectuer un Règlement</h3>
                <form [formGroup]="reglementForm" (ngSubmit)="onValiderReglement()" class="form">
                    <div class="form-group">
                    <label for="montant">Montant à régler *</label>
                    <input type="number" id="montant" formControlName="montant" class="form-input" />
                    </div>
                    <div class="form-group">
                      <label>Mode de règlement *</label>
                      <div class="mode-grid">
                        <div *ngFor="let mode of modesReglement" class="mode-card" [class.selected]="reglementForm.get('modeReglement')?.value === mode" (click)="reglementForm.get('modeReglement')?.setValue(mode)">
                          <div class="mode-logo">
                            <ng-container [ngSwitch]="mode">
                              <img *ngSwitchCase="'Espèces'" src="assets/logos/cash.png" alt="Espèces" />
                              <img *ngSwitchCase="'Wave'" src="assets/logos/wave.png" alt="Wave" />
                              <img *ngSwitchCase="'Orange Money'" src="assets/logos/orange-money.png" alt="Orange Money" />
                              <img *ngSwitchCase="'Moov Money'" src="assets/logos/moov-money.png" alt="Moov Money" />
                              <img *ngSwitchCase="'MTN Money'" src="assets/logos/mtn.jpeg" alt="MTN Money" />
                              
                              <img *ngSwitchCase="'Chèque'" src="assets/logos/cheque.jpeg" alt="Chèque" />
                              <span *ngSwitchDefault class="mode-placeholder">?</span>
                            </ng-container>
                          </div>
                          <div class="mode-label">{{ mode }}</div>
                        </div>
                      </div>
                      <div *ngIf="reglementForm.get('modeReglement')?.invalid && reglementForm.get('modeReglement')?.touched" class="text-red">Veuillez sélectionner un mode de règlement.</div>
                    </div>
                    <div *ngIf="reglementForm.get('modeReglement')?.value && reglementForm.get('modeReglement')?.value !== 'Espèces'" class="form-group">
                    <label for="reference">Référence de l'opération</label>
                    <input type="text" id="reference" formControlName="reference" class="form-input" placeholder="ID de transaction, N° de chèque..." />
                    </div>
                    <div class="form-group">
                    <button type="submit" [disabled]="isLoading || reglementForm.invalid" class="btn btn-success">
                        {{ isLoading ? 'Validation...' : 'Valider le Règlement' }}
                    </button>
                    </div>
                </form>
                </div>
            </div>
        </div>

       
    </div>


    
    </div>
</div>

 <!-- Centered receipt, only if recu exists -->
        <div *ngIf="recu" class="recu-center animate-slide-in-up">
            <div class="card recu-preview">
                <div class="recu-header company-info">
                <h1>ASSURANCE MANAGER</h1>
                <p>Société d'Assurance Professionnelle</p>
                <p>123 Avenue des Assurances, 75001 Paris</p>
                <p>Tél: 01 23 45 67 89 | Email: contact@assurancemanager.fr</p>
                </div>
                <div class="recu-title">
                <h2>REÇU DE CAISSE</h2>
                <p class="recu-number">N° {{ recu.numeroRecu }}</p>
                </div>
                <div class="recu-info-grid">
                <div class="info-row"><span class="label">Numéro de pièce:</span><span class="value">{{ recu.numeroPiece }}</span></div>
                <div class="info-row"><span class="label">Client:</span><span class="value">{{ recu.client }}</span></div>
                <div class="info-row"><span class="label">Montant:</span><span class="value">{{ recu.montant | number:'1.2-2' }} €</span></div>
                <div class="info-row"><span class="label">Mode de règlement:</span><span class="value">{{ recu.modeReglement }}</span></div>
                <div *ngIf="recu.reference" class="info-row"><span class="label">Référence:</span><span class="value">{{ recu.reference }}</span></div>
                <div class="info-row"><span class="label">Utilisateur:</span><span class="value">{{ recu.utilisateur }}</span></div>
                </div>
            </div>
            <div class="action-buttons">
                <button (click)="imprimerRecu()" class="btn btn-secondary">Imprimer le Reçu</button>
                <button (click)="onNouvelleRecherche()" class="btn btn-primary">Nouvelle Recherche</button>
            </div>
        </div>
<br><br>
</div>
 

